<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sophia - Sweet Edition ‚ú®</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap');
        
        :root {
            --main-pink: #ff85a1;
            --soft-bg: #fff5f7;
            --glass: rgba(255, 255, 255, 0.8);
        }

        body { 
            font-family: 'Kanit', sans-serif; 
            background: linear-gradient(135deg, #fff5f7 0%, #ffe4e9 50%, #fff0f3 100%); 
            min-height: 100vh; margin: 0; padding-bottom: 110px; overflow-x: hidden; color: #7d5a5a;
        }

        /* --- ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏ü‡∏∏‡πâ‡∏á‡∏ü‡∏¥‡πâ‡∏á --- */
        .leaf-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
        .leaf { position: absolute; display: block; filter: drop-shadow(0 0 5px #ffb6c1); animation: fall linear infinite; }
        @keyframes fall { 
            0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 1; } 
            100% { transform: translateY(110vh) translateX(100px) rotate(360deg); opacity: 0; } 
        }

        .container { 
            background: var(--glass); backdrop-filter: blur(15px); 
            margin: 25px auto; padding: 30px; border-radius: 45px; 
            width: 85%; max-width: 400px; text-align: center; 
            box-shadow: 0 15px 35px rgba(255, 133, 161, 0.3); border: 4px solid white; 
            animation: bounceIn 0.8s ease;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.9); opacity: 0; }
            70% { transform: scale(1.02); }
            100% { transform: scale(1); opacity: 1; }
        }

        .shop-header { 
            font-size: 45px; color: var(--main-pink); font-weight: bold; 
            margin: 10px 0; text-shadow: 3px 3px 0px white, 0 0 10px rgba(255, 133, 161, 0.5); 
        }

        /* --- Modal ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 182, 193, 0.4); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center; z-index: 2000;
        }
        .summary-card {
            background: white; width: 92%; max-width: 380px; border-radius: 45px; overflow: hidden;
            animation: popUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            box-shadow: 0 25px 50px rgba(255, 105, 180, 0.3); border: 5px solid #fff;
        }
        @keyframes popUp { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .summary-body { padding: 25px; text-align: left; }
        .info-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 2px dashed #fff0f3; padding-bottom: 6px; font-size: 15px; }

        .history-table { width: 100%; border-collapse: collapse; margin-top: 15px; border-radius: 20px; overflow: hidden; }
        .history-table th { background: #ffccd5; color: #d63384; padding: 12px; text-align: left; font-size: 14px; }
        .history-table td { padding: 12px; background: #fffcfd; border-bottom: 1px solid #fff0f3; font-size: 13px; }

        /* --- UI Elements --- */
        .btn-main { 
            width: 100%; padding: 16px; background: linear-gradient(45deg, #ffafbd, #ff85a1); 
            color: white; border: none; border-radius: 50px; font-weight: bold; 
            cursor: pointer; margin-top: 15px; font-size: 17px; 
            box-shadow: 0 8px 15px rgba(255, 133, 161, 0.4); transition: 0.3s; 
            border: 2px solid rgba(255,255,255,0.5);
        }
        .btn-main:hover { transform: translateY(-3px); box-shadow: 0 12px 20px rgba(255, 133, 161, 0.6); }
        .btn-main:active { transform: scale(0.95); }
        
        input { 
            width: 100%; padding: 15px; border-radius: 30px; border: 2px solid #ffe1e6; 
            margin-bottom: 15px; box-sizing: border-box; font-family: 'Kanit'; 
            background: #fffafa; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--main-pink); box-shadow: 0 0 10px rgba(255, 133, 161, 0.2); }
        
        .nav-bar { 
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; height: 85px; background: rgba(255, 255, 255, 0.9); 
            display: none; justify-content: space-around; align-items: center; 
            border-radius: 45px; box-shadow: 0 10px 30px rgba(255, 133, 161, 0.3); z-index: 1000;
            border: 3px solid white;
        }
        .nav-item { text-align: center; color: #ffccd5; cursor: pointer; flex: 1; transition: 0.3s; }
        .nav-item.active { color: var(--main-pink); transform: scale(1.1); font-weight: bold; }
        .nav-item i { font-size: 24px; margin-bottom: 4px; }

        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        #myBar { 
            background: linear-gradient(90deg, #ffafbd, #ff85a1, #ffc2d1); 
            box-shadow: 0 0 15px rgba(255, 133, 161, 0.5);
        }
    </style>
</head>
<body>

    <div class="leaf-container" id="leaves"></div>

    <div class="modal-overlay" id="summaryModal">
        <div class="summary-card">
            <div style="background: linear-gradient(45deg, #ff85a1, #ffafbd); color: white; padding: 22px; text-align: center; font-weight: bold; font-size: 20px;">
                üß∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á
            </div>
            <div class="summary-body">
                <div class="info-row"><span>üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</span> <span id="mId" style="font-weight: bold; color: var(--main-pink);">-</span></div>
                <div class="info-row"><span>üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</span> <span id="mEmail">-</span></div>
                <div class="info-row"><span>üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span> <span id="mPhone">-</span></div>
                
                <div style="background: #fff5f7; padding: 15px; border-radius: 25px; margin: 15px 0; border: 2px dashed #ffccd5;">
                    <div class="info-row" style="border:none;"><span>üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏°:</span> <span id="mGoal">0.-</span></div>
                    <div class="info-row" style="border:none;"><span>‚úÖ ‡∏ú‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß:</span> <span id="mPaid" style="color: #2fb380; font-weight: bold;">0.-</span></div>
                    <div class="info-row" style="border:none; padding:0;"><span>‚åõ ‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á:</span> <span id="mBalance" style="color: #ff4d6d; font-weight: bold;">0.-</span></div>
                </div>

                <div style="font-weight: bold; font-size: 14px; margin-bottom: 8px; color: #ff85a1;"><i class="fa-solid fa-heart"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                <div style="max-height: 180px; overflow-y: auto; border-radius: 20px; border: 1px solid #ffe1e6;">
                    <table class="history-table">
                        <tbody id="historyTableBody"></tbody>
                    </table>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn-main" style="background: #ffc2d1; color: #d63384; font-size: 13px; padding: 10px; margin: 0; flex: 1;" onclick="reportProblem()">
                        ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ‚òÅÔ∏è
                    </button>
                    <button class="btn-main" style="background: #ff85a1; font-size: 13px; padding: 10px; margin: 0; flex: 1;" onclick="contactAdmin()">
                        ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô üéÄ
                    </button>
                </div>
                <button class="btn-main" style="background: #7d5a5a;" onclick="document.getElementById('summaryModal').style.display='none'">
                    ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á ‚ú®
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <h1 class="shop-header">Sophia üå∏</h1>

        <div id="page-auth" class="page active">
            <div style="margin-bottom: 20px; font-size: 15px; color: #ff85a1;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏¢‡∏≠‡∏î‡∏≠‡∏≠‡∏°‡∏ô‡∏∞‡∏Ñ‡∏∞ ‚ú®</div>
            <input type="text" id="userInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á ‚ú®">
            <input type="email" id="emailInput" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Email) ‚òÅÔ∏è">
            <input type="tel" id="phoneInput" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå üì±">
            <button class="btn-main" id="loginBtn" onclick="handleAuth()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÄ‡∏•‡∏¢ ‚ú®</button>
        </div>

        <div id="page-pay" class="page">
            <h3 style="color:var(--main-pink); margin-top:0;">‡πÅ‡∏à‡πâ‡∏á‡∏™‡πà‡∏á‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ üç∞</h3>
            <img src="https://promptpay.io/0981250127.png" style="width:180px; border-radius:35px; border:6px solid white; box-shadow: 0 10px 25px rgba(255, 133, 161, 0.4);">
            <p style="font-weight: bold; color: #7d5a5a; margin: 15px 0;">PromptPay: 098-125-0127</p>
            <input type="number" id="payAmount" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)">
            <label style="font-size: 12px; color: #ff85a1; display: block; text-align: left; margin-left: 15px;">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏Ñ‡πà‡∏∞ :</label>
            <input type="file" id="slipFile" accept="image/*" style="border:none; background:transparent;">
            <button class="btn-main" id="submitBtn" onclick="submitPayment()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡∏ú‡πà‡∏≠‡∏ô üíñ</button>
        </div>

        <div id="page-history" class="page">
            <h3 style="color:var(--main-pink); margin-top:0;">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á üöÄ</h3>
            <div style="background: #fff; border-radius: 30px; height: 35px; overflow: hidden; margin: 25px 0; border: 3px solid #fff0f3;">
                <div id="myBar" style="height: 100%; width: 0%; transition: 1.5s; display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: bold;">0%</div>
            </div>
            <button class="btn-main" style="background: white; color: var(--main-pink); border: 2px solid var(--main-pink);" onclick="openSummary()">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
        </div>
    </div>

    <nav class="nav-bar" id="navBar">
        <div class="nav-item active" onclick="showPage('pay', this)"><i class="fa-solid fa-cookie-bite"></i><p>‡∏™‡πà‡∏á‡∏¢‡∏≠‡∏î</p></div>
        <div class="nav-item" onclick="showPage('history', this)"><i class="fa-solid fa-star"></i><p>‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</p></div>
        <div class="nav-item" onclick="location.reload()"><i class="fa-solid fa-door-open"></i><p>‡∏≠‡∏≠‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</p></div>
    </nav>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxP_DzyivVZytKHWdhYoMZVmFc8KGD0MiJUFU2L0-1zzXTg2anWE-R9AOKm1pMfNAiA/exec"; 

        function createLeaves() {
            const container = document.getElementById('leaves');
            const hearts = ['‚ù§Ô∏è', 'üíñ', '‚ú®', 'üå∏', '‚òÅÔ∏è'];
            for (let i = 0; i < 20; i++) {
                const leaf = document.createElement('div');
                leaf.className = 'leaf';
                leaf.innerHTML = hearts[Math.floor(Math.random() * hearts.length)];
                leaf.style.left = Math.random() * 100 + 'vw';
                leaf.style.fontSize = Math.random() * 20 + 10 + 'px';
                leaf.style.animationDuration = (Math.random() * 5 + 5) + 's';
                container.appendChild(leaf);
            }
        }
        createLeaves();

        function showPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-'+id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            if(id === 'history') updateProgress();
        }

        async function handleAuth() {
            const user = document.getElementById('userInput').value.trim();
            const email = document.getElementById('emailInput').value.trim();
            const phone = document.getElementById('phoneInput').value.trim();
            if(!user || !email || !phone) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡πâ‡∏≤‡∏≤ ‚ú®");

            const btn = document.getElementById('loginBtn');
            btn.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÄ‡∏Å‡πà‡∏á... üéÄ'; btn.disabled = true;

            try {
                const res = await fetch(`${SCRIPT_URL}?user=${encodeURIComponent(user)}`);
                const data = await res.json();
                if ((data.history && data.history.length > 0) || (data.goal && data.goal > 0)) {
                    userData = data;
                    document.getElementById('page-auth').classList.remove('active');
                    document.getElementById('page-pay').classList.add('active');
                    document.getElementById('navBar').style.display = 'flex';
                } else {
                    alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡πâ‡∏≤ ‚ú®");
                    btn.innerHTML = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‚ú®'; btn.disabled = false;
                }
            } catch (e) { alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞‡∏Ñ‡∏∞"); btn.disabled = false; }
        }

        async function updateProgress() {
            const user = document.getElementById('userInput').value.trim();
            const res = await fetch(`${SCRIPT_URL}?user=${encodeURIComponent(user)}`);
            const data = await res.json();
            const paid = parseFloat(data.total) || 0;
            const goal = parseFloat(data.goal) || 0;
            const percent = goal > 0 ? Math.min((paid/goal)*100, 100).toFixed(1) : 0;
            const bar = document.getElementById('myBar');
            bar.style.width = percent + "%";
            bar.innerText = percent + "%";
            if(percent >= 100) confetti({ particleCount: 150, spread: 70, colors: ['#ff85a1', '#ffccd5'] });
        }

        function openSummary() {
            if(!userData) return;
            document.getElementById('mId').innerText = document.getElementById('userInput').value;
            document.getElementById('mEmail').innerText = document.getElementById('emailInput').value;
            document.getElementById('mPhone').innerText = document.getElementById('phoneInput').value;
            const goal = parseFloat(userData.goal) || 0;
            const paid = parseFloat(userData.total) || 0;
            document.getElementById('mGoal').innerText = goal.toLocaleString() + ".-";
            document.getElementById('mPaid').innerText = paid.toLocaleString() + ".-";
            document.getElementById('mBalance').innerText = Math.max(0, goal - paid).toLocaleString() + ".-";

            const tableBody = document.getElementById('historyTableBody');
            tableBody.innerHTML = userData.history.map(item => `
                <tr>
                    <td style="color:#7d5a5a;">${item.date}</td>
                    <td style="text-align: right; font-weight: bold; color: #ff85a1;">${parseFloat(item.amount).toLocaleString()}</td>
                </tr>
            `).join('') || '<tr><td colspan="2" style="text-align:center; padding:20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡πà‡∏∞</td></tr>';
            document.getElementById('summaryModal').style.display = 'flex';
        }

        async function submitPayment() {
            const user = document.getElementById('userInput').value;
            const amt = document.getElementById('payAmount').value;
            const file = document.getElementById('slipFile').files[0];
            if(!amt || !file) return alert("‡πÉ‡∏™‡πà‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞ ‚ú®");

            const btn = document.getElementById('submitBtn');
            btn.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... ‚ú®"; btn.disabled = true;

            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                try {
                    await fetch(SCRIPT_URL, { 
                        method: "POST", 
                        body: JSON.stringify({ 
                            username: user, email: document.getElementById('emailInput').value,
                            phone: document.getElementById('phoneInput').value,
                            amount: amt, slipFile: reader.result 
                        }) 
                    });
                    alert("‡∏™‡πà‡∏á‡∏¢‡∏≠‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞! ‡∏£‡∏≠‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞ üíñ");
                    document.getElementById('payAmount').value = "";
                } catch (e) { alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡πà‡∏∞"); }
                btn.innerHTML = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡∏ú‡πà‡∏≠‡∏ô üíñ"; btn.disabled = false;
            };
        }

        function reportProblem() { window.open(`https://m.me/100083236314354`, '_blank'); }
        function contactAdmin() { window.open('https://www.facebook.com/share/1BfizcSA3j/', '_blank'); }
    </script>
</body>
</html>
